(function(){var k,o,q,m,i,r,l,c,j,n,s=Object.prototype.hasOwnProperty,p=function(a,b){function d(){this.constructor=a}for(var e in b)s.call(b,e)&&(a[e]=b[e]);d.prototype=b.prototype;a.prototype=new d;a.__super__=b.prototype;return a};n=require("underscore");k=require("jquery");console.log(exports);"undefined"!==typeof exports&&null!==exports&&(c=exports);c||(c={});c.VERSION="0.0.0";j={};c.state=j;o=function(){function a(){this.cache={}}a.prototype.cached_get=function(a){var d;return(d=this.cache)[a]||
(d[a]=this.perform("GET",a))};a.prototype.clear_cache=function(){return this.cache={}};a.prototype.method_override=function(a,d,e,f){"GET"!==a&&"POST"!==a&&(f||(f={}),f["X-Http-Method-Override"]=a,e||(e={}),e._method=a,a="POST");return[a,d,e,f]};return a}();q=function(a){function b(a){this.host="http://"+a||"";b.__super__.constructor.apply(this,arguments)}p(b,a);b.prototype.perform=function(a,b,f,c){var g,h;h=this.method_override(a,b,f,c);a=h[0];b=h[1];f=h[2];c=h[3];g=k.Deferred();k.ajax(this.host+
b,{data:f,type:a,success:function(a){try{return g.resolve(JSON.parse(a))}catch(b){return g.resolve(a)}},error:function(a){return g.reject(a)},headers:c});return g.promise()};return b}(o);r=function(a){function b(a){this.host=a;b.__super__.constructor.apply(this,arguments);this._xhr=new easyXDM.Rpc({remote:"http://"+this.host+"/api/connector/v1/assets/cors.html"},{remote:{request:{}}})}p(b,a);b.prototype.perform=function(a,b,f,c){var g,h;h=this.method_override(a,b,f,c);a=h[0];b=h[1];f=h[2];c=h[3];
g=k.Deferred();this._xhr.request({url:b,data:f,method:a,headers:c},function(a){try{return g.resolve(JSON.parse(a.data))}catch(b){return g.resolve(a.data)}},function(a){return g.reject(a)});return g.promise()};return b}(o);j.connector=null;l=k.Deferred();c.connected=l.promise();c.connect=function(a){"undefined"!==typeof window&&null!==window&&null!=a&&a!==window.location.host?k.getScript("http://"+a+"/api/connector/v1/assets/easyXDM.js",function(){j.connector=new r(a);if(null!=l)return l.resolve(j.connector)}):
(j.connector=new q(a),null!=l&&l.resolve(j.connector));return l=null};c.ServiceSet=function(){function a(a){null!=a&&this.use(a)}a.prototype.use=function(a){var d=this;return n.each(a,function(a,b){return d[b]=new c.GenericService({name:b,version:a})})};return a}();c.GenericService=function(){function a(a){this.base_url="/api/"+a.name+"/v"+a.version}a.prototype.service_url=function(a){return this.base_url+a};a.prototype.perform=function(a,d,c){return j.connector.perform(a,this.service_url(d),c)};
a.prototype.get=function(a,d){return this.perform("GET",a,d)};a.prototype.cached_get=function(a){return j.connector.cached_get(this.service_url(a))};a.prototype.post=function(a,d){return this.perform("POST",a,d)};a.prototype["delete"]=function(a,d){return this.perform("DELETE",a,d)};return a}();c.services=new c.ServiceSet;m=function(a){function b(a){this.message=a}p(b,a);b.prototype.name="InvalidUidError";return b}(Error);i=function(){function a(b,d,c){if(1===arguments.length&&"string"===typeof arguments[0])return a.fromString(arguments[0]);
this.klass=function(b){if(!b)return null;if(!a.valid_klass(b))throw new m("Invalid klass '"+b+"'");return b}(b);this.path=function(b){if(!b)return null;if(!a.valid_path(b))throw new m("Invalid path '"+b+"'");return k.trim(b)||null}(d);this.oid=function(b){if(!b)return null;if(!a.valid_oid(b))throw new m("Invalid oid '"+b+"'");return k.trim(b)||null}(c);if(!this.klass)throw new m("Missing klass in uid");if(!this.path&&!this.oid)throw new m("A valid uid must specify either path or oid");}a.prototype.clone=
function(){return new a(this.klass,this.path,this.oid)};a.prototype.toString=function(){return""+this.klass+":"+this.path+((this.oid?"$"+this.oid:void 0)||"")};return a}();n.extend(i,{fromString:function(a){var b,c,e;e=i.raw_parse(a);a=e[0];c=e[1];b=e[2];return new i(a,c,b)},raw_parse:function(a){var b,c;return!(b=a.match(/((.*)^[^:]+)?\:([^\$]*)?\$?(.*$)?/))?[]:(c=[b[1],b[3],b[4]],c)},valid:function(a){try{if(new i(a))return!0}catch(b){return!1}},parse:function(a){a=new i(a);return[a.klass,a.path,
a.oid]},valid_label:function(a){return a.match(/^[a-zA-Z0-9_]+$/)},valid_klass:function(a){return i.valid_label(a)},valid_path:function(a){n.each(a.split("."),function(a){if(!i.valid_label(a))return!1});return!0},valid_oid:function(a){return i.valid_label(a)}});c.Uid=i;if("undefined"===typeof exports||null===exports)this.pebblecore=c}).call(this);
