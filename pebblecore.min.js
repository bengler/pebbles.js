(function(){var j,n,p,k,i,q,c,l,m,r=Object.prototype.hasOwnProperty,o=function(a,b){function d(){this.constructor=a}for(var e in b)r.call(b,e)&&(a[e]=b[e]);d.prototype=b.prototype;a.prototype=new d;a.__super__=b.prototype;return a};m=require("underscore");j=require("jQuery");"undefined"!==typeof exports&&null!==exports&&(c=exports);c||(c={});c.VERSION="0.0.0";l={connector:null};c.state=l;n=function(){function a(){this.cache={}}a.prototype.cached_get=function(a){var d;return(d=this.cache)[a]||(d[a]=
this.perform("GET",a))};a.prototype.clear_cache=function(){return this.cache={}};a.prototype.method_override=function(a,d,e,f){"GET"!==a&&"POST"!==a&&(f||(f={}),f["X-Http-Method-Override"]=a,e||(e={}),e._method=a,a="POST");return[a,d,e,f]};return a}();p=function(a){function b(){b.__super__.constructor.apply(this,arguments)}o(b,a);b.prototype.perform=function(a,b,f,c){var g,h;h=this.method_override(a,b,f,c);a=h[0];b=h[1];f=h[2];c=h[3];g=j.Deferred();j.ajax(b,{data:f,type:a,success:function(a){try{return g.resolve(JSON.parse(a))}catch(b){return g.resolve(a)}},
error:function(a){return g.reject(a)},headers:c});return g.promise()};return b}(n);q=function(a){function b(a){this.host=a;b.__super__.constructor.apply(this,arguments);this._xhr=new easyXDM.Rpc({remote:"http://"+this.host+"/api/connector/v1/assets/cors.html"},{remote:{request:{}}})}o(b,a);b.prototype.perform=function(a,b,f,c){var g,h;h=this.method_override(a,b,f,c);a=h[0];b=h[1];f=h[2];c=h[3];g=j.Deferred();this._xhr.request({url:b,data:f,method:a,headers:c},function(a){try{return g.resolve(JSON.parse(a.data))}catch(b){return g.resolve(a.data)}},
function(a){return g.reject(a)});return g.promise()};return b}(n);c.connect=function(a){if("undefined"!==typeof window&&null!==window&&null!=a&&a!==window.location.host)return j.getScript("http://"+a+"/api/connector/v1/assets/easyXDM.js",function(){l.connector=new q(a);return j(c).trigger("connected")});l.connector=new p;return j(c).trigger("connected")};c.ServiceSet=function(){function a(a){null!=a&&this.use(a)}a.prototype.use=function(a){var d=this;return m.each(a,function(a,b){return d[b]=new c.GenericService({name:b,
version:a})})};return a}();c.GenericService=function(){function a(a){this.base_url="/api/"+a.name+"/v"+a.version}a.prototype.service_url=function(a){return this.base_url+a};a.prototype.perform=function(a,d,c){return l.connector.perform(a,this.service_url(d),c)};a.prototype.get=function(a,d){return this.perform("GET",a,d)};a.prototype.cached_get=function(a){return l.connector.cached_get(this.service_url(a))};a.prototype.post=function(a,d){return this.perform("POST",a,d)};a.prototype["delete"]=function(a,
d){return this.perform("DELETE",a,d)};return a}();k=function(a){function b(a){this.message=a}o(b,a);b.prototype.name="InvalidUidError";return b}(Error);i=function(){function a(b,d,c){if(1===arguments.length&&"string"===typeof arguments[0])return a.fromString(arguments[0]);this.klass=function(b){if(!b)return null;if(!a.valid_klass(b))throw new k("Invalid klass '"+b+"'");return b}(b);this.path=function(b){if(!b)return null;if(!a.valid_path(b))throw new k("Invalid path '"+b+"'");return j.trim(b)||null}(d);
this.oid=function(b){if(!b)return null;if(!a.valid_oid(b))throw new k("Invalid oid '"+b+"'");return j.trim(b)||null}(c);if(!this.klass)throw new k("Missing klass in uid");if(!this.path&&!this.oid)throw new k("A valid uid must specify either path or oid");}a.prototype.clone=function(){return new a(this.klass,this.path,this.oid)};a.prototype.toString=function(){return""+this.klass+":"+this.path+((this.oid?"$"+this.oid:void 0)||"")};return a}();m.extend(i,{fromString:function(a){var b,c,e;e=i.raw_parse(a);
a=e[0];c=e[1];b=e[2];return new i(a,c,b)},raw_parse:function(a){var b,c;return!(b=a.match(/((.*)^[^:]+)?\:([^\$]*)?\$?(.*$)?/))?[]:(c=[b[1],b[3],b[4]],c)},valid:function(a){try{if(new i(a))return!0}catch(b){return!1}},parse:function(a){a=new i(a);return[a.klass,a.path,a.oid]},valid_label:function(a){return a.match(/^[a-zA-Z0-9_]+$/)},valid_klass:function(a){return i.valid_label(a)},valid_path:function(a){m.each(a.split("."),function(a){if(!i.valid_label(a))return!1});return!0},valid_oid:function(a){return i.valid_label(a)}});
c.Uid=i;if("undefined"===typeof exports||null===exports)this.pebblecore=c}).call(this);
